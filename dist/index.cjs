"use strict";var x=Object.create;var m=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var b=(a,t)=>{for(var r in t)m(a,r,{get:t[r],enumerable:!0})},y=(a,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of R(t))!I.call(a,o)&&o!==r&&m(a,o,{get:()=>t[o],enumerable:!(n=E(t,o))||n.enumerable});return a};var p=(a,t,r)=>(r=a!=null?x(L(a)):{},y(t||!a||!a.__esModule?m(r,"default",{value:a,enumerable:!0}):r,a)),P=a=>y(m({},"__esModule",{value:!0}),a);var S={};b(S,{ReelRipper:()=>g});module.exports=P(S);var _=p(require("axios"),1),h=p(require("fs"),1),w=p(require("path"),1),v=p(require("mime-types"),1),g=class{constructor(){}encodedBaseUrl(t,r){let n="https://api.instagram.com/graphql/query/",o=["8845758582119845","10068642573147916"],i=[{shortcode:r,fetch_tagged_user_count:null,hoisted_comment_id:null,hoisted_reply_id:null},{id:r,render_surface:"PROFILE"}];return encodeURI(`${n}?doc_id=${o[t]}&variables=${JSON.stringify(i[t])}`)}getUsername(t){try{let r=new URL(t),n=r.pathname.split("/").filter(Boolean);if(r.hostname.endsWith("instagram.com")&&n.length===1&&!["p","reel","reels","tv"].includes(n[0]))return n[0]}catch{}return null}getShortcode(t){try{let r=new URL(t),n=r.pathname.split("/").filter(Boolean);if(r.hostname.endsWith("instagram.com")&&n.length===2&&["p","reel","reels","tv"].includes(n[0]))return n[1]}catch{}return null}async getProfileId(t){if(typeof t!="string")throw new Error("Username is required");let n=`https://www.instagram.com/${this.getUsername(t)||(/^[a-zA-Z0-9._]+$/.test(t)?t:null)}`;try{let o=await _.default.get(n);if(o.status===200)return o.data.match(/"profilePage_([0-9]+)"/)[1]||null}catch{throw new Error("Profile not found")}return null}async getMediaURL(t){if(typeof t!="string")throw new Error("Media URL is required");let r=this.getShortcode(t);if(r){let n=this.encodedBaseUrl(0,r);try{let o=await _.default.get(n);if(o.status===200)switch(o.data.data.xdt_shortcode_media.__typename){case"XDTGraphSidecar":return o.data.data.xdt_shortcode_media.edge_sidecar_to_children.edges.map(d=>d.node.__typename==="XDTGraphVideo"?d.node.video_url:d.node.__typename==="XDTGraphImage"?d.node.display_url:null).filter(Boolean);case"XDTGraphVideo":return Array(o.data.data.xdt_shortcode_media.video_url);case"XDTGraphImage":return Array(o.data.data.xdt_shortcode_media.display_url)}}catch{throw new Error("Something went wrong! Check if the media URL is valid.")}}throw new Error("Invalid media URL!")}async getProfileInfo(t){if(typeof t!="string")throw new Error("Profile URL is required");let r=this.getUsername(t)||(/^[a-zA-Z0-9._]+$/.test(t)?t:null),n=await this.getProfileId(r);if(n){let o=this.encodedBaseUrl(1,n);try{let i=await _.default.get(o);if(i.status===200){let e=i.data.data.user;return{is_private:e.is_private,is_verified:e.is_verified,full_name:e.full_name,profile_pic:e.hd_profile_pic_url_info.url,username:e.username,bio:e.biography,external_url:e.external_url,follower_count:e.follower_count,following_count:e.following_count,media_count:e.media_count,user_id:e.id}}}catch{throw new Error("Something went wrong!")}}throw new Error("Invalid profile URL!")}async getMediaInfo(t,r=!1){if(typeof t!="string")throw new Error("Media URL is required");let n=this.getShortcode(t);if(n){let o=this.encodedBaseUrl(0,n);try{let i=await _.default.get(o);if(i.status===200){let e=i.data.data.xdt_shortcode_media,l=r?[...e.edge_media_to_parent_comment.edges.map(s=>({owner:s.node.owner.username,text:s.node.text,profile_pic:s.node.owner.profile_pic_url})),...e.edge_media_preview_comment.edges.map(s=>({owner:s.node.owner.username,text:s.node.text,profile_pic:s.node.owner.profile_pic_url}))].filter((s,f,u)=>f===u.findIndex(c=>c.owner===s.owner&&c.text===s.text)):[];return{id:e.id,shortcode:e.shortcode,type:e.__typename,published_at:e.taken_at_timestamp,is_video:e.is_video,has_audio:!!e.has_audio,comments_count:e.edge_media_preview_comment.count,likes_count:e.edge_media_preview_like.count,caption:e.edge_media_to_caption.edges[0].node.text,accessibility_caption:e.accessibility_caption,dimensions:e.dimensions,owner:e.owner.username,owner_name:e.owner.full_name,owner_id:e.owner.id,tagged_users:e.edge_media_to_tagged_user.edges.map(s=>s.node.user.username),owner_profile_pic:e.owner.profile_pic_url,display_url:e.display_url,location:e.location?e.location.name:null,is_paid_partnership:e.is_paid_partnership,is_ad:e.is_ad,sponsors:e.edge_media_to_sponsor_user.edges.map(s=>s.node.sponsor.username),video_url:e.is_video?e.video_url:null,video_play_count:e.is_video?e.video_play_count:null,video_duration:e.is_video?e.video_duration:null,comments:l}}}catch(i){throw console.log(i),new Error("Something went wrong! Check if the media URL is valid.")}}throw new Error("Invalid media URL!")}async downloadMedia(t,r="media"){if(typeof t!="string")throw new Error("Media URL is required");let n=this.getShortcode(t);if(n){let o=await this.getMediaURL(t);if(o){let i=w.default.join(r,n);h.default.existsSync(i)||h.default.mkdirSync(i,{recursive:!0});for(let e=0;e<o.length;e++){let l=o[e];try{let d=await(0,_.default)({method:"GET",url:l,responseType:"stream"}),s=d.headers["content-type"],f=v.default.extension(s)||"bin",u=w.default.join(i,`${e+1}.${f}`),c=h.default.createWriteStream(u);d.data.pipe(c),c.on("finish",()=>{console.log(`\u2705 Media ${e+1} has been downloaded to ${u}`)}),c.on("error",U=>{console.error("\u274C Error writing file:",U.message)})}catch(d){console.error(`Failed to download ${l}:`,d)}}}}else throw new Error("Invalid media URL!")}};0&&(module.exports={ReelRipper});
